#!/bin/sh
echo "üì¶ Bumping version..."

# Run version bump script
node scripts/bump-version.js
VERSION_BUMP_EXIT_CODE=$?

if [ $VERSION_BUMP_EXIT_CODE -ne 0 ]; then
  echo "‚ùå Version bump failed. Please fix the issue before committing."
  exit 1
fi

# Stage the updated package.json files
git add backend/package.json frontend/package.json

echo "üîç Running ESLint on changed JavaScript files..."

# Get list of staged JS/JSX files in frontend
STAGED_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '^frontend/src/.*\.(js|jsx)$' || true)

if [ -n "$STAGED_FILES" ]; then
  echo "Checking files:"
  echo "$STAGED_FILES"
  
  # Run ESLint on staged files only
  cd frontend
  
  # Convert paths to be relative to frontend directory
  FILES_TO_LINT=$(echo "$STAGED_FILES" | sed 's|^frontend/||' | tr '\n' ' ')
  
  if [ -n "$FILES_TO_LINT" ]; then
    npx eslint $FILES_TO_LINT --max-warnings=0
    LINT_EXIT_CODE=$?
    
    if [ $LINT_EXIT_CODE -ne 0 ]; then
      echo "‚ùå ESLint found errors in changed files. Please fix them before committing."
      cd ..
      exit 1
    fi
  fi
  
  cd ..
  echo "‚úÖ ESLint passed on changed files!"
else
  echo "‚ÑπÔ∏è  No JavaScript files changed, skipping ESLint"
fi

